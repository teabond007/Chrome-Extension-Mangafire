import{R as g,C as b,O as v}from"./reader-enhancements-db3a7f4d.js";const c={id:"mangaplus",name:"MangaPlus",unitName:"chapter",PREFIX:"mp:",selectors:{cardContainer:'div[class*="TitleList"]',card:'a[href*="/titles/"]',cardTitle:'h3, div[class*="TitleName"]',cardLink:'a[href*="/titles/"]',cardCover:"img"},extractCardData(e){var r;let t="",n="",a="";n=e.href,a=this.extractIdFromUrl(n);const o=e.querySelector('h3, div[class*="TitleName"], p');return t=((r=o==null?void 0:o.textContent)==null?void 0:r.trim())||"",{id:a,title:t,slug:a,url:n}},extractIdFromUrl(e){if(!e)return"";const t=e.match(/\/titles\/(\d+)/);return t?t[1]:""},applyBorder(e,t,n,a){const r=e.querySelector('div[class*="Cover"]')||e;r.style.setProperty("border",`${n}px ${a} ${t}`,"important"),r.style.setProperty("box-sizing","border-box","important"),r.style.setProperty("border-radius","4px","important"),r.style.setProperty("position","relative","important")},getBadgePosition(){return{top:"4px",right:"4px"}},buildChapterUrl(e,t){return null},isReaderPage(){return window.location.href.includes("/viewer/")},parseUrl(e){const t=this.extractIdFromUrl(e);return t?{slug:null,id:t,chapterNo:null}:null},goToNextChapter(){},goToPrevChapter(){},exitReader(){const e=document.querySelector('a[href*="/titles/"]');e?e.click():window.history.back()}};function w(e){const t=e.match(/\/viewer\/(\d+)/);return t?t[1]:null}function p(){var u,m;if(!((u=chrome.runtime)!=null&&u.id))return;const e=window.location.href,t=w(e);if(!t)return;const n=document.querySelector('h1, a[href*="/titles/"]'),a=(m=n==null?void 0:n.textContent)==null?void 0:m.trim();if(!a){i("Could not extract title from reader page");return}const o=document.querySelector('a[href*="/titles/"]'),r=o?c.extractIdFromUrl(o.href):null;if(!r){i("Could not extract manga ID from reader page");return}const s=`${c.PREFIX}${r}`;chrome.storage.local.get(["savedReadChapters"],y=>{if(chrome.runtime.lastError)return;let l=y.savedReadChapters||{},h=!1;l[s]||(l[s]=[]),l[s].includes(t)||(l[s].push(t),h=!0);const C=l[s].length;chrome.runtime.sendMessage({type:"autoSyncEntry",title:a,chapter:t,slugWithId:`mangaplus-${r}`,readChapters:C,source:"mangaplus"},()=>{chrome.runtime.lastError}),h&&chrome.storage.local.set({savedReadChapters:l},()=>{chrome.runtime.lastError||i(`Saved chapter ${t} for ${a}`)})})}function i(e){var n;if(!((n=chrome.runtime)!=null&&n.id))return;const t=typeof e=="object"?JSON.stringify(e):e;chrome.runtime.sendMessage({type:"log",text:`[MangaPlus] ${t}`},()=>{chrome.runtime.lastError})}function E(){if(document.getElementById("bmh-mangaplus-styles"))return;const e=document.createElement("style");e.id="bmh-mangaplus-styles",e.textContent=`
        @keyframes bmh-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
    `,document.head.appendChild(e),v.injectStyles()}async function d(){var o;if(!((o=chrome.runtime)!=null&&o.id))return;i("MangaPlus CardEnhancer v3.8.0 (Bundled) initializing..."),E();const e=await new Promise(r=>{chrome.storage.local.get(["MangaPlusHighlightEnabled","MangaPlusQuickActionsEnabled","CustomBorderSize","CustomBorderSizefeatureEnabled","CustomBookmarksfeatureEnabled","customBookmarks","MangaPlusShowProgress"],s=>{if(chrome.runtime.lastError){r({});return}r(s)})});if(e.MangaPlusHighlightEnabled===!1){i("Highlighting disabled");return}const t=new b(c,{highlighting:!0,progressBadges:e.MangaPlusShowProgress!==!1,quickActions:e.MangaPlusQuickActionsEnabled!==!1,CustomBorderSize:e.CustomBorderSizefeatureEnabled?e.CustomBorderSize:4,CustomBookmarksfeatureEnabled:e.CustomBookmarksfeatureEnabled,customBookmarks:e.customBookmarks}),n=await t.enhanceAll();i(`Enhanced ${n} cards`),window.location.href.includes("/viewer/")&&(setTimeout(p,1500),new g(c).init(),i("Reader enhancements initialized")),new MutationObserver(r=>{r.some(u=>u.addedNodes.length>0)&&t.enhanceAll()}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>setTimeout(d,1e3)):setTimeout(d,1e3);window.addEventListener("load",()=>setTimeout(d,1e3));let f=location.href;const P=new MutationObserver(()=>{var e;(e=chrome.runtime)!=null&&e.id&&location.href!==f&&(f=location.href,document.querySelectorAll("[data-bmh-enhanced]").forEach(t=>{delete t.dataset.bmhEnhanced}),setTimeout(d,1e3),location.href.includes("/viewer/")&&setTimeout(()=>{p(),new g(c).init()},1500))});P.observe(document,{subtree:!0,childList:!0});
