import{F as f,S as T,B as b,T as h,C as x}from"./config-sTLp4FTN.js";import{w as B,b as U,i as w,e as p,r as u,S as r}from"./storage-schema-DbDZlffU.js";function K(){const S=u(!1),g=u(!0),s=u("cloudy-dark"),i=u({...T}),m=u({...b}),a=u({...f}),d=u("medium"),c=u([]),v=u({}),E=p(()=>h[s.value]||h["cloudy-dark"]),A=p(()=>x[d.value]||x.medium),F=p(()=>Object.entries(h).map(([e,t])=>({id:e,name:t.name}))),l=u({general:{markHomePage:!1,syncAndMarkRead:!1,familyFriendly:!1},automation:{smartAutoComplete:!1,smartInactivityFade:!1,smartResume:!1},reader:{enhancements:!0,widthFix:!1,nextChapter:!0},highlights:{mangadex:!0,webtoons:!0},appearance:{theme:"cloudy-dark",accentColor:"",libraryData:{progressBars:!0}},dates:{}});async function R(){g.value=!0;try{const e=await chrome.storage.local.get([r.THEME,r.STATUS_COLORS,r.BORDER_STYLE,r.BORDER_SIZE,r.CUSTOM_MARKERS,"features","cardSize"]);e[r.THEME]&&(s.value=e[r.THEME]),e.features&&(a.value={...f,...e.features}),l.value.general.markHomePage=a.value.markHomePage,l.value.general.syncAndMarkRead=a.value.syncAndMarkRead,l.value.general.familyFriendly=a.value.familyFriendly,l.value.automation.smartAutoComplete=a.value.smartAutoComplete,l.value.automation.smartInactivityFade=a.value.smartInactivityDim,l.value.automation.smartResume=a.value.smartResume,l.value.reader.enhancements=a.value.readerEnhancements,l.value.reader.widthFix=a.value.readerWidthFix,l.value.reader.nextChapter=a.value.readerNextChapter,l.value.highlights.mangadex=a.value.mangadexHighlight,l.value.highlights.webtoons=a.value.webtoonsHighlight,l.value.appearance.theme=s.value,l.value.appearance.libraryData.progressBars=a.value.progressBadges,S.value=!0,console.log("[useSettings] ✓ Settings loaded")}catch(e){console.error("[useSettings] Failed to load settings:",e)}finally{g.value=!1}}async function M(e){a.value.markHomePage=e.general.markHomePage,a.value.syncAndMarkRead=e.general.syncAndMarkRead,a.value.familyFriendly=e.general.familyFriendly,a.value.smartAutoComplete=e.automation.smartAutoComplete,a.value.smartInactivityDim=e.automation.smartInactivityFade,a.value.smartResume=e.automation.smartResume,a.value.readerEnhancements=e.reader.enhancements,a.value.readerWidthFix=e.reader.widthFix,a.value.readerNextChapter=e.reader.nextChapter,a.value.mangadexHighlight=e.highlights.mangadex,a.value.webtoonsHighlight=e.highlights.webtoons,a.value.progressBadges=e.appearance.libraryData.progressBars,s.value=e.appearance.theme,await n()}async function n(){try{await chrome.storage.local.set({[r.THEME]:s.value,[r.STATUS_COLORS]:i.value,[r.BORDER_STYLE]:m.value.style,[r.BORDER_SIZE]:m.value.size,[r.CUSTOM_MARKERS]:c.value,features:a.value,cardSize:d.value,platformSettings:v.value}),console.log("[useSettings] ✓ Settings saved")}catch(e){console.error("[useSettings] Failed to save settings:",e)}}async function O(e,t){const o=e.split(".");o.length===1?e==="theme"?s.value=t:e==="cardSize"&&(d.value=t):o[0]==="border"?m.value[o[1]]=t:o[0]==="features"?a.value[o[1]]=t:o[0]==="statusColors"?i.value[o[1]]=t:o[0]==="platforms"&&o.length===3&&(v.value[o[1]]||(v.value[o[1]]={}),v.value[o[1]][o[2]]=t),await n()}function P(e){return i.value[e]||"transparent"}function H(e){return a.value[e]??!1}async function k(e){a.value[e]=!a.value[e],await n()}async function D(e,t){c.value.push({name:e,color:t}),await n()}async function _(e){c.value=c.value.filter(t=>t.name!==e),await n()}function y(){const e=E.value,t=document.documentElement;t.style.setProperty("--color-bg-body",e.bgBody),t.style.setProperty("--color-bg-sidebar",e.bgSidebar),t.style.setProperty("--color-bg-surface",e.bgSurface),t.style.setProperty("--color-bg-elevated",e.bgElevated),t.style.setProperty("--color-primary",e.accentPrimary),t.style.setProperty("--color-accent",e.accentSecondary),t.style.setProperty("--color-text-primary",e.textPrimary),t.style.setProperty("--color-text-secondary",e.textSecondary),t.style.setProperty("--color-text-muted",e.textMuted),t.style.setProperty("--color-border",e.border)}async function L(){s.value="cloudy-dark",i.value={...T},m.value={...b},a.value={...f},d.value="medium",c.value=[],await n(),y()}function C(e,t){t==="local"&&(e[r.THEME]&&(s.value=e[r.THEME].newValue,y()),e[r.STATUS_COLORS]&&(i.value=e[r.STATUS_COLORS].newValue),e.features&&(a.value=e.features.newValue))}return B(s,()=>{y()}),U(async()=>{await R(),y(),chrome.storage.onChanged.addListener(C)}),w(()=>{chrome.storage.onChanged.removeListener(C)}),{settings:l,isLoaded:S,isLoading:g,theme:s,statusColors:i,border:m,features:a,cardSize:d,customMarkers:c,platforms:v,themeConfig:E,cardDimensions:A,availableThemes:F,loadSettings:R,saveSettings:n,updateSettings:M,updateSetting:O,getStatusColor:P,isFeatureEnabled:H,toggleFeature:k,addCustomMarker:D,removeCustomMarker:_,applyTheme:y,resetToDefaults:L}}export{K as u};
