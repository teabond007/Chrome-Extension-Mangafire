import{C as p,R as f,O as y}from"./reader-enhancements-db3a7f4d.js";const d={id:"mangadex",name:"MangaDex",unitName:"chapter",PREFIX:"mangadex:",selectors:{card:'.manga-card, .hchaptercard, [class*="chapter-feed__container"]',cardTitle:'a[href*="/title/"] h6, a.title span, a.title, [class*="title"]',cardLink:'a[href*="/title/"]',cardCover:".manga-card-cover img, img"},extractCardData(e){var i;let t="",r="",n="";const a=e.querySelector(this.selectors.cardLink);if(a){r=a.href,n=this.extractUUID(r);let o;e.classList.contains("hchaptercard")?o=e.querySelector('a[href*="/title/"] h6'):o=e.querySelector("a.title span")||e.querySelector("a.title")||e.querySelector('[class*="title"]'),t=((i=o==null?void 0:o.textContent)==null?void 0:i.trim())||""}return{id:n,title:t,slug:this.slugify(t),url:r}},extractUUID(e){if(!e)return"";const t=e.match(/\/(title|chapter)\/([a-f0-9-]{36})/i);return t?t[2]:""},slugify(e){return e?e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""):""},applyBorder(e,t,r,n){let a;e.classList.contains("hchaptercard")?a=e.querySelector('a[href*="/title/"]')||e:a=e.querySelector(".manga-card-cover")||e,a.style.setProperty("border",`${r}px ${n} ${t}`,"important"),a.style.setProperty("border-radius","8px","important"),a.style.setProperty("box-sizing","border-box","important"),a.style.setProperty("position","relative","important"),e._bmhBorderTarget=a},getBadgePosition(){return{bottom:"4px",left:"4px"}},buildChapterUrl(e,t){return null},isReaderPage(){return window.location.href.includes("/chapter/")},parseUrl(e){return null},goToNextChapter(){const e=Array.from(document.querySelectorAll("a")).find(t=>t.textContent.includes("Next")||t.textContent.includes("next"));e&&e.click()},goToPrevChapter(){const e=Array.from(document.querySelectorAll("a")).find(t=>t.textContent.includes("Previous")||t.textContent.includes("Prev"));e&&e.click()},exitReader(){const e=document.querySelector('a[href*="/title/"]');e?e.click():window.history.back()}};function x(e){const t=e.match(/\/chapter\/([a-f0-9-]{36})/i);return t?t[1]:null}function g(){var u,s;if(!((u=chrome.runtime)!=null&&u.id))return;const e=window.location.href,t=x(e);if(!t)return;const r=document.querySelector('[class*="title"]')||document.querySelector('a[href*="/title/"]'),n=(s=r==null?void 0:r.textContent)==null?void 0:s.trim();if(!n){l("Could not extract title from reader page");return}const a=document.querySelector('a[href*="/title/"]'),i=a?d.extractUUID(a.href):null,o=i?`${d.PREFIX}${i}`:n;chrome.storage.local.get(["savedReadChapters"],h=>{if(chrome.runtime.lastError)return;let c=h.savedReadChapters||{};c[o]||(c[o]=[]),c[o].includes(t)||(c[o].push(t),chrome.storage.local.set({savedReadChapters:c},()=>{chrome.runtime.lastError||l(`Saved chapter ${t} for ${n}`)})),chrome.runtime.sendMessage({type:"autoSyncEntry",title:n,chapter:t,slugWithId:`mangadex-${i||"unknown"}`,readChapters:c[o].length,source:"mangadex"},()=>{chrome.runtime.lastError})})}function l(e){var r;if(!((r=chrome.runtime)!=null&&r.id))return;const t=typeof e=="object"?JSON.stringify(e):e;chrome.runtime.sendMessage({type:"log",text:`[MangaDex] ${t}`},()=>{chrome.runtime.lastError})}function b(){if(document.getElementById("bmh-mangadex-styles"))return;const e=document.createElement("style");e.id="bmh-mangadex-styles",e.textContent=`
        @keyframes bmh-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
    `,document.head.appendChild(e),y.injectStyles()}async function m(){var u;if(!((u=chrome.runtime)!=null&&u.id))return;l("MangaDex CardEnhancer v3.8.0 (Bundled) initializing..."),b();const e=await new Promise(s=>{chrome.storage.local.get(["MangaDexHighlightEnabled","MangaDexQuickActionsEnabled","CustomBorderSize","CustomBorderSizefeatureEnabled","CustomBookmarksfeatureEnabled","customBookmarks","MangaDexShowProgress"],h=>{if(chrome.runtime.lastError){s({});return}s(h)})});if(e.MangaDexHighlightEnabled===!1){l("Highlighting disabled");return}const t=new p(d,{highlighting:!0,progressBadges:e.MangaDexShowProgress!==!1,quickActions:e.MangaDexQuickActionsEnabled!==!1,CustomBorderSize:e.CustomBorderSizefeatureEnabled?e.CustomBorderSize:4,CustomBookmarksfeatureEnabled:e.CustomBookmarksfeatureEnabled,customBookmarks:e.customBookmarks}),r=await t.enhanceAll();l(`Enhanced ${r} cards (Quick Actions: ${e.MangaDexQuickActionsEnabled!==!1?"ON":"OFF"})`),window.location.href.includes("/chapter/")&&(g(),new f(d).init(),l("Reader enhancements initialized"));let n;new MutationObserver(()=>{clearTimeout(n),n=setTimeout(()=>t.enhanceAll(),200)}).observe(document.body,{childList:!0,subtree:!0});let i=location.href;new MutationObserver(()=>{location.href!==i&&(i=location.href,document.querySelectorAll("[data-bmh-enhanced]").forEach(s=>{delete s.dataset.bmhEnhanced}),setTimeout(()=>t.enhanceAll(),500),location.href.includes("/chapter/")&&setTimeout(()=>{g(),new f(d).init()},1e3))}).observe(document,{subtree:!0,childList:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>setTimeout(m,800)):setTimeout(m,500);window.addEventListener("load",()=>setTimeout(m,500));
