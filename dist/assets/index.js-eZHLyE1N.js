import{_ as m,c as y,g as x,a as l,x as b,d as c,n as v,y as C,t as k,z as w}from"./_plugin-vue_export-helper-DrK4Gf5m.js";import{C as E}from"./config-0i2jtrsc.js";import{S as g}from"./storage-schema-DNpnt-ap.js";const S=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.overlay-container{display:contents}.quick-tooltip{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transform:translateY(-4px);transition:all .2s cubic-bezier(.4,0,.2,1);z-index:60;pointer-events:none}:host([visible]) .quick-tooltip,:host(:hover) .quick-tooltip{opacity:1;transform:translateY(0);pointer-events:auto}.action-btn{width:28px;height:28px;border:none;border-radius:6px;background:#000000d9;color:#fff;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s ease;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);box-shadow:0 2px 8px #0006;padding:0}.action-btn:hover{transform:scale(1.1);background:#1e1e1ef2}.action-btn.disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.continue-btn{background:linear-gradient(135deg,#4caf50,#388e3c)}.continue-btn:hover:not(.disabled){background:linear-gradient(135deg,#66bb6a,#43a047)}.status-btn .status-dot{width:10px;height:10px;border-radius:50%;background-color:var(--status-color)}.rating-btn{color:#fbbf24}",R={class:"overlay-container"},q={class:"quick-tooltip"},$=["title"],A=["title"],L=["title"],B={__name:"QuickActionsOverlay.ce",props:{entry:{type:Object,required:!0},statusColors:{type:Object,default:()=>({Reading:"#4ade80",Completed:"#60a5fa","Plan to Read":"#fbbf24","On-Hold":"#f97316",Dropped:"#ef4444","Re-reading":"#a855f7"})}},emits:["continue","open-status","open-rating","details"],setup(r,{emit:t}){const e=r,s=c(()=>e.entry.status||"Plan to Read"),i=c(()=>{var a;return((a=e.entry.personalData)==null?void 0:a.rating)||0}),n=c(()=>e.entry.lastReadChapter?parseFloat(e.entry.lastReadChapter):0),h=c(()=>!0),p=c(()=>n.value>0?n.value+1:1),d=c(()=>n.value>0?`Continue Ch. ${p.value}`:"Start Reading"),f=c(()=>e.statusColors[s.value]||"#9ca3af");return(a,o)=>(x(),y("div",R,[l("div",q,[l("button",{class:v(["action-btn continue-btn",{disabled:!h.value}]),title:d.value,onClick:o[0]||(o[0]=b(u=>a.$emit("continue"),["stop"]))},[...o[4]||(o[4]=[l("span",{class:"icon"},"▶",-1)])],10,$),l("button",{class:"action-btn status-btn",title:s.value,style:C({"--status-color":f.value}),onClick:o[1]||(o[1]=b(u=>a.$emit("open-status",u),["stop"]))},[...o[5]||(o[5]=[l("span",{class:"status-dot"},null,-1)])],12,A),l("button",{class:"action-btn rating-btn",title:`Rating: ${i.value}/10`,onClick:o[2]||(o[2]=b(u=>a.$emit("open-rating",u),["stop"]))},k(i.value>0?i.value:"★"),9,L),l("button",{class:"action-btn info-btn",title:"View Details",onClick:o[3]||(o[3]=b(u=>a.$emit("details"),["stop"]))}," ℹ ")])]))}},_=m(B,[["styles",[S]]]),M=w(_);customElements.get("bmh-quick-actions")||customElements.define("bmh-quick-actions",M);class z{constructor(t){this.adapter=t,this.settings={highlighting:!0,quickActions:!0},this.library=new Map,this.observer=null,this.config=null}async init(){console.log(`[CardEnhancer] Initializing for ${this.adapter.name}...`),await this.loadSettings(),await this.loadLibrary(),this.enhanceVisibleCards(),this.startObserver(),chrome.storage.onChanged.addListener((t,e)=>{e==="local"&&(t[g.LIBRARY]&&this.loadLibrary().then(()=>this.enhanceVisibleCards()),(t.features||t.statusColors)&&this.loadSettings().then(()=>this.enhanceVisibleCards()))})}async loadSettings(){this.config=await E.load(),this.settings.highlighting=this.config.isFeatureEnabled("highlighting"),this.settings.quickActions=this.config.isFeatureEnabled("quickActions")}async loadLibrary(){const e=(await chrome.storage.local.get(g.LIBRARY))[g.LIBRARY]||[];this.library.clear(),e.forEach(s=>{s.sourceId&&this.library.set(`${s.source}:${s.sourceId}`,s),s.slug&&this.library.set(`${s.source}:${s.slug}`,s),s.slug&&s.source===this.adapter.id&&this.library.set(s.slug,s)})}startObserver(){this.observer=new MutationObserver(t=>{let e=!1;for(const s of t)if(s.addedNodes.length>0){e=!0;break}e&&(this._debounce&&clearTimeout(this._debounce),this._debounce=setTimeout(()=>this.enhanceVisibleCards(),200))}),this.observer.observe(document.body,{childList:!0,subtree:!0})}enhanceVisibleCards(){const t=this.adapter.selectors.card;if(!t)return;document.querySelectorAll(t).forEach(s=>this.enhanceCard(s))}enhanceCard(t){if(t.dataset.bmhEnhanced)return;const e=this.adapter.extractCardData(t);if(!e||!e.id&&!e.title)return;const s=this.findMatch(e);t.dataset.bmhEnhanced="true",t.addEventListener("mouseenter",()=>{const i=t.querySelector("bmh-quick-actions");i&&i.setAttribute("visible","")}),t.addEventListener("mouseleave",()=>{const i=t.querySelector("bmh-quick-actions");i&&i.removeAttribute("visible")}),this.settings.highlighting&&s&&this.applyBorder(t,s),this.settings.quickActions&&this.mountQuickActions(t,s||this.createTemporaryEntry(e))}findMatch(t){if(t.id){const e=`${this.adapter.id}:${t.id}`;if(this.library.has(e))return this.library.get(e)}if(t.slug){const e=`${this.adapter.id}:${t.slug}`;if(this.library.has(e))return this.library.get(e);if(this.library.has(t.slug))return this.library.get(t.slug)}return null}createTemporaryEntry(t){return{id:t.id,title:t.title,slug:t.slug,status:null,source:this.adapter.id,sourceUrl:t.url}}applyBorder(t,e){const s=this.config?this.config.getStatusColor(e.status):"transparent";this.adapter.applyBorder?this.adapter.applyBorder(t,s):(t.style.border=`3px solid ${s}`,t.style.borderRadius="8px")}mountQuickActions(t,e){const s=document.createElement("bmh-quick-actions");s.entry=e,s.statusColors=this.config?this.config.statusColors:{},getComputedStyle(t).position==="static"&&(t.style.position="relative"),s.addEventListener("continue",()=>this.handleContinue(e)),s.addEventListener("open-status",i=>this.handleStatus(i,e)),s.addEventListener("open-rating",i=>this.handleRating(i,e)),s.addEventListener("details",()=>this.handleDetails(e)),t.appendChild(s)}handleContinue(t){t.lastReadUrl?window.location.href=t.lastReadUrl:t.sourceUrl&&(window.location.href=t.sourceUrl)}handleStatus(t,e){alert("Status Picker placeholder for "+e.title)}handleRating(t,e){alert("Rating Picker placeholder for "+e.title)}handleDetails(t){console.log("Details for",t),t.sourceUrl&&window.open(t.sourceUrl,"_blank")}}const F={id:"mangafire",name:"MangaFire",selectors:{card:".unit, .swiper-slide, .item",cardLink:'a[href*="/manga/"]',cardTitle:".info a, .info h6 a, .above a"},extractCardData(r){try{const t=r.querySelector(this.selectors.cardTitle),e=t?t.textContent.trim():"",s=r.querySelector(this.selectors.cardLink),i=s?s.href:"";let n="",h="";if(i){const p=i.match(/\/manga\/([^/?#]+)/);if(p){n=p[1];const d=n.split(".");d.length>1&&(h=d[d.length-1])}}return{title:e,url:i,slug:n,id:h}}catch(t){return console.warn("Error extracting card data",t),null}},applyBorder(r,t){let e=r;if(r.classList.contains("swiper-slide")){const i=r.querySelector(".poster")||r;i.style.border=`3px solid ${t}`,i.style.borderRadius="8px",i.style.boxSizing="border-box";return}const s=r.querySelector(".poster");s&&(e=s),e.style.border=`3px solid ${t}`,e.style.borderRadius="8px",e.style.boxSizing="border-box"}},I=new z(F);I.init();console.log("[MangaFire] Enhancer loaded.");
