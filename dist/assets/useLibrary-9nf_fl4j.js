import{h as w,r as v,o as L,a as S,i as p}from"./runtime-dom.esm-bundler-Drjs8M-n.js";import{S as x}from"./storage-schema-ZmkWod5v.js";function C(e,d){const s=v(d);let u=!1;async function c(){try{const o=await chrome.storage.local.get(e);o[e]!==void 0&&(u=!0,s.value=o[e],u=!1)}catch(o){console.error(`[useSyncedStorage] Failed to load ${e}:`,o)}}function l(o,f){f==="local"&&o[e]&&(u=!0,s.value=o[e].newValue,u=!1)}return w(s,async o=>{if(!u)try{await chrome.storage.local.set({[e]:o})}catch(f){console.error(`[useSyncedStorage] Failed to save ${e}:`,f)}},{deep:!0}),L(()=>{c(),chrome.storage.onChanged.addListener(l)}),S(()=>{chrome.storage.onChanged.removeListener(l)}),s}function I(){const e=C(x.LIBRARY,[]),d=v(""),s=v("ALL"),u=v("lastReadDate"),c=v(!0),l=p(()=>Array.isArray(e.value)?e.value:[]),o=p(()=>{let t=[...l.value];if(s.value!=="ALL"&&(t=t.filter(n=>n.status===s.value)),d.value.trim()){const n=d.value.toLowerCase();t=t.filter(r=>r.title&&r.title.toLowerCase().includes(n)||r.slug&&r.slug.toLowerCase().includes(n))}return t.sort((n,r)=>{const a=n[u.value],i=r[u.value];return a===i?0:a==null?1:i==null?-1:typeof a=="string"?c.value?i.localeCompare(a):a.localeCompare(i):c.value?i-a:a-i}),t}),f=p(()=>({total:l.value.length,reading:l.value.filter(t=>t.status==="Reading").length,completed:l.value.filter(t=>t.status==="Completed").length,planToRead:l.value.filter(t=>t.status==="Plan to Read").length,onHold:l.value.filter(t=>t.status==="On-Hold").length,dropped:l.value.filter(t=>t.status==="Dropped").length,rereading:l.value.filter(t=>t.status==="Re-reading").length}));function g(t,n){if(!Array.isArray(e.value))return;const r=e.value.findIndex(a=>a.id===t);if(r!==-1){const a=e.value[r];a.status=n,a.updatedAt=Date.now(),a.lastUpdated=Date.now(),e.value=[...e.value]}}function y(t,n){if(!Array.isArray(e.value))return;const r=e.value.findIndex(a=>a.id===t);if(r!==-1){const a=e.value[r];a.personalData||(a.personalData={}),a.personalData.rating=n,a.lastUpdated=Date.now(),e.value=[...e.value]}}function h(t){Array.isArray(e.value)&&(e.value=e.value.filter(n=>n.id!==t))}function m(){e.value=[]}function A(t,n){if(!Array.isArray(e.value))return;const r=e.value.findIndex(a=>a.id===t);if(r!==-1){const a=e.value[r];a.personalData||(a.personalData={}),a.personalData.tags=n,a.lastUpdated=Date.now(),e.value=[...e.value]}}function D(t,n){if(!Array.isArray(e.value))return;const r=e.value.findIndex(a=>a.id===t);if(r!==-1){const a=e.value[r];a.personalData||(a.personalData={}),a.personalData.notes=n,a.lastUpdated=Date.now(),e.value=[...e.value]}}return{entries:e,entriesArray:l,filteredEntries:o,stats:f,searchQuery:d,statusFilter:s,sortBy:u,sortDesc:c,updateStatus:g,updateRating:y,updateTags:A,updateNotes:D,removeEntry:h,clearLibrary:m}}export{I as u};
