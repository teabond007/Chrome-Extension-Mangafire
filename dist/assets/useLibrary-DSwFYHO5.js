import{D as A,o as L,m as S,r as v,d as g}from"./_plugin-vue_export-helper-DrK4Gf5m.js";import{S as w}from"./storage-schema-CQTxiJkW.js";function D(e,d){const s=v(d);let u=!1;async function c(){try{const o=await chrome.storage.local.get(e);o[e]!==void 0&&(u=!0,s.value=o[e],u=!1)}catch(o){console.error(`[useSyncedStorage] Failed to load ${e}:`,o)}}function r(o,f){f==="local"&&o[e]&&(u=!0,s.value=o[e].newValue,u=!1)}return A(s,async o=>{if(!u)try{await chrome.storage.local.set({[e]:o})}catch(f){console.error(`[useSyncedStorage] Failed to save ${e}:`,f)}},{deep:!0}),L(()=>{c(),chrome.storage.onChanged.addListener(r)}),S(()=>{chrome.storage.onChanged.removeListener(r)}),s}function x(){const e=D(w.LIBRARY,[]),d=v(""),s=v("ALL"),u=v("lastReadDate"),c=v(!0),r=g(()=>Array.isArray(e.value)?e.value:[]),o=g(()=>{let t=[...r.value];if(s.value!=="ALL"&&(t=t.filter(n=>n.status===s.value)),d.value.trim()){const n=d.value.toLowerCase();t=t.filter(l=>l.title&&l.title.toLowerCase().includes(n)||l.slug&&l.slug.toLowerCase().includes(n))}return t.sort((n,l)=>{const a=n[u.value],i=l[u.value];return a===i?0:a==null?1:i==null?-1:typeof a=="string"?c.value?i.localeCompare(a):a.localeCompare(i):c.value?i-a:a-i}),t}),f=g(()=>({total:r.value.length,reading:r.value.filter(t=>t.status==="Reading").length,completed:r.value.filter(t=>t.status==="Completed").length,planToRead:r.value.filter(t=>t.status==="Plan to Read").length,onHold:r.value.filter(t=>t.status==="On-Hold").length,dropped:r.value.filter(t=>t.status==="Dropped").length,rereading:r.value.filter(t=>t.status==="Re-reading").length}));function p(t,n){if(!Array.isArray(e.value))return;const l=e.value.findIndex(a=>a.id===t);if(l!==-1){const a=e.value[l];a.status=n,a.updatedAt=Date.now(),a.lastUpdated=Date.now(),e.value=[...e.value]}}function m(t,n){if(!Array.isArray(e.value))return;const l=e.value.findIndex(a=>a.id===t);if(l!==-1){const a=e.value[l];a.personalData||(a.personalData={}),a.personalData.rating=n,a.lastUpdated=Date.now(),e.value=[...e.value]}}function h(t){Array.isArray(e.value)&&(e.value=e.value.filter(n=>n.id!==t))}function y(){e.value=[]}return{entries:e,entriesArray:r,filteredEntries:o,stats:f,searchQuery:d,statusFilter:s,sortBy:u,sortDesc:c,updateStatus:p,updateRating:m,removeEntry:h,clearLibrary:y}}export{x as u};
