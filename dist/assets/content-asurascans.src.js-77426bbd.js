import{C as m,R as g,O as y}from"./reader-enhancements-86b09aa0.js";const l={id:"asurascans",name:"Asura Scans",unitName:"chapter",PREFIX:"asura:",selectors:{card:'a[href*="/series/"]:has(img), div.grid.grid-cols-12:has(a[href*="/series/"])',cardTitle:'span.font-medium, a[href*="/series/"] span, h2, h3',cardLink:'a[href*="/series/"]',cardCover:"img.object-cover, img"},extractCardData(t){var o,u;let e="",r="",s="";const c=t.tagName==="A"?t:t.querySelector('a[href*="/series/"]');if(c&&(r=c.href,s=this.extractSlug(r),e=((o=(t.querySelector(this.selectors.cardTitle)||c.querySelector("span")||c).textContent)==null?void 0:o.trim())||"",e=e.split(/\n|Chapter/i)[0].trim()),!e&&t.classList.contains("grid")){const i=t.querySelector('span.font-medium a, a[href*="/series/"]');i&&(e=(u=i.textContent)==null?void 0:u.trim(),r=i.href,s=this.extractSlug(r))}return{id:s,title:e,slug:s,url:r}},extractSlug(t){try{const e=new URL(t).pathname.split("/").filter(s=>s),r=e.indexOf("series");return r!==-1&&e[r+1]?e[r+1]:e[e.length-1]}catch{return""}},applyBorder(t,e,r,s){t.style.setProperty("border",`${r}px ${s} ${e}`,"important"),t.style.setProperty("border-radius","8px","important"),t.style.setProperty("box-sizing","border-box","important")},getBadgePosition(){return{bottom:"8px",left:"8px"}},buildChapterUrl(t,e){return t.slug?`https://asuracomic.net/series/${t.slug}/chapter-${e}`:null},isReaderPage(){return window.location.href.includes("/chapter")},parseUrl(t){const e=t.match(/\/series\/([^/]+)\/chapter[/-]?([\d.-]+)/i);return e?{slug:e[1],chapterNo:parseFloat(e[2])}:null},goToNextChapter(){const t=document.querySelector('a[href*="/chapter"]:has(svg[class*="right"]), button:has(svg[stroke*="next"]), .next-chapter');t&&t.click()},goToPrevChapter(){const t=document.querySelector('a[href*="/chapter"]:has(svg[class*="left"]), button:has(svg[stroke*="prev"]), .prev-chapter');t&&t.click()},exitReader(){const t=document.querySelector('a[href*="/series/"]:not([href*="/chapter"])');t?window.location.href=t.href:window.history.back()}};function b(t){const e=t.match(/\/chapter[/-]?([\d.-]+)/i);return e?e[1]:null}function f(){var u,i;if(!((u=chrome.runtime)!=null&&u.id))return;const t=window.location.href,e=b(t);if(!e)return;const r=document.querySelector('h1, span.font-bold, a[href*="/series/"]'),s=(i=r==null?void 0:r.textContent)==null?void 0:i.trim();if(!s)return;const c=l.extractSlug(t),o=`${l.PREFIX}${c}`;chrome.storage.local.get(["savedReadChapters"],d=>{if(chrome.runtime.lastError)return;let a=d.savedReadChapters||{};a[o]||(a[o]=[]),a[o].includes(e)||(a[o].push(e),chrome.storage.local.set({savedReadChapters:a},()=>{chrome.runtime.lastError||n(`Saved chapter ${e} for ${s}`)})),chrome.runtime.sendMessage({type:"autoSyncEntry",title:s,chapter:e,slugWithId:`asura-${c}`,readChapters:a[o].length,source:"asurascans"},()=>{chrome.runtime.lastError})})}function n(t){var r;if(!((r=chrome.runtime)!=null&&r.id))return;const e=typeof t=="object"?JSON.stringify(t):t;chrome.runtime.sendMessage({type:"log",text:`[AsuraScans] ${e}`},()=>{chrome.runtime.lastError})}function C(){if(document.getElementById("bmh-asura-styles"))return;const t=document.createElement("style");t.id="bmh-asura-styles",t.textContent=`
        @keyframes bmh-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
    `,document.head.appendChild(t),y.injectStyles()}async function h(){var t;try{if(!((t=chrome.runtime)!=null&&t.id)){console.error("[AsuraScans] Invalid runtime ID");return}n("Asura Scans CardEnhancer v3.8.0 (with Quick Actions) initializing..."),C(),n("Fetching settings...");const e=await new Promise(a=>{chrome.storage.local.get(["AsuraScansHighlightEnabled","AsuraScansQuickActionsEnabled","CustomBorderSize","CustomBorderSizefeatureEnabled","CustomBookmarksfeatureEnabled","customBookmarks"],p=>{if(chrome.runtime.lastError){n(`Settings error: ${chrome.runtime.lastError.message}`),a({});return}a(p)})});if(n(`Settings loaded: ${JSON.stringify(e)}`),e.AsuraScansHighlightEnabled===!1){n("Highlighting disabled");return}if(typeof m>"u"){n("CRITICAL: CardEnhancer is undefined!");return}const r=new m(l,{highlighting:!0,progressBadges:!0,quickActions:e.AsuraScansQuickActionsEnabled!==!1,CustomBorderSize:e.CustomBorderSizefeatureEnabled?e.CustomBorderSize:4,CustomBookmarksfeatureEnabled:e.CustomBookmarksfeatureEnabled,customBookmarks:e.customBookmarks}),s=r.findCards();n(`Found ${s.length} potential cards`);const c=await r.enhanceAll();n(`Enhanced ${c} cards`),window.location.href.includes("/chapter")&&(n("Initializing reader features..."),f(),new g(l).init(),n("Reader enhancements initialized"));let o;new MutationObserver(()=>{clearTimeout(o),o=setTimeout(()=>r.enhanceAll(),200)}).observe(document.body,{childList:!0,subtree:!0});let i=location.href;new MutationObserver(()=>{location.href!==i&&(i=location.href,document.querySelectorAll("[data-bmh-enhanced]").forEach(a=>{delete a.dataset.bmhEnhanced}),setTimeout(()=>r.enhanceAll(),800),location.href.includes("/chapter")&&setTimeout(f,1e3))}).observe(document,{subtree:!0,childList:!0})}catch(e){console.error("[AsuraScans] CRITICAL ERROR:",e),n(`CRITICAL ERROR: ${e.message}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>setTimeout(h,800)):setTimeout(h,500);window.addEventListener("load",()=>setTimeout(h,500));
