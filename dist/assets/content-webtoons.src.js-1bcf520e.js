import{C as b,R as g,O as y}from"./reader-enhancements-db3a7f4d.js";console.log("[Webtoons] Script loaded! URL:",window.location.href);const d={id:"webtoons",name:"Webtoons",unitName:"episode",PREFIX:"webtoon:",selectors:{card:'li:has(a[class*="_title_a"])',cardTitle:".title, .subj, strong.title",cardLink:'a[class*="_title_a"], a.link',cardCover:"img"},extractCardData(e){var i;let t="",o="",r="",n="";const s=e.querySelector(this.selectors.cardLink)||(e.tagName==="A"?e:null);if(s){o=s.href;const a=this.extractInfoFromUrl(o);r=a.titleNo,n=a.slug;const u=e.querySelector(".title")||e.querySelector(".subj")||e.querySelector("p.subj")||e.querySelector(".info .subj")||e.querySelector(".info_area .subj");u?t=((i=u.textContent)==null?void 0:i.trim())||"":s.getAttribute("title")&&(t=s.getAttribute("title"))}return{id:r,title:t,slug:n,url:o}},extractInfoFromUrl(e){if(!e)return{titleNo:"",slug:"",episodeNo:null};try{const t=new URL(e),o=t.pathname.match(/\/(?:webtoon|challenge)\/([^/]+)/),r=o?o[1]:"",n=t.searchParams.get("title_no")||"",s=t.searchParams.get("episode_no")||null;return{titleNo:n,slug:r,episodeNo:s}}catch{return{titleNo:"",slug:"",episodeNo:null}}},applyBorder(e,t,o,r){const n=e.closest("li")||e;n.style.setProperty("border",`${o}px ${r} ${t}`,"important"),n.style.setProperty("border-radius","8px","important"),n.style.setProperty("box-sizing","border-box","important"),n.style.setProperty("position","relative","important")},getBadgePosition(){return{bottom:"4px",left:"4px"}},buildChapterUrl(e,t){const o=e.sourceUrl||e.url;if(!o)return null;try{const r=new URL(o);if(r.pathname.endsWith("/list"))return r.pathname=r.pathname.replace("/list","/viewer"),r.searchParams.set("episode_no",t),r.toString()}catch{return null}return null},isReaderPage(){return window.location.href.includes("episode_no")||window.location.href.includes("/viewer")},parseUrl(e){const t=this.extractInfoFromUrl(e);return{slug:t.slug,id:t.titleNo,chapterNo:parseFloat(t.episodeNo)}},goToNextChapter(){const e=document.querySelector(".pg_next")||document.querySelector("a.next");e&&e.click()},goToPrevChapter(){const e=document.querySelector(".pg_prev")||document.querySelector("a.prev");e&&e.click()},exitReader(){const e=document.querySelector("#detail_list_btn")||document.querySelector('a[href*="/list"]');if(e)e.click();else{const t=new URL(window.location.href);t.pathname=t.pathname.replace("/viewer","/list"),t.searchParams.delete("episode_no"),window.location.href=t.toString()}}};function f(){var a,u;if(!((a=chrome.runtime)!=null&&a.id))return;const e=window.location.href,{titleNo:t,slug:o,episodeNo:r}=d.extractInfoFromUrl(e);if(!r)return;const n=document.querySelector(".subj"),s=(u=n==null?void 0:n.textContent)==null?void 0:u.trim();if(!s||!o)return;const i=`${d.PREFIX}${o}`;chrome.storage.local.get(["savedReadChapters"],p=>{if(chrome.runtime.lastError)return;let c=p.savedReadChapters||{};c[i]||(c[i]=[]),c[i].includes(r)||(c[i].push(r),chrome.storage.local.set({savedReadChapters:c},()=>{chrome.runtime.lastError||l(`Saved episode ${r} for ${s} (${o})`)})),chrome.runtime.sendMessage({type:"autoSyncEntry",title:s,chapter:r,slugWithId:`webtoon-${o}`,readChapters:c[i].length,source:"webtoons"},()=>{chrome.runtime.lastError})})}function l(e){var o;const t=typeof e=="object"?JSON.stringify(e):e;console.log(`[Webtoons] ${t}`),(o=chrome.runtime)!=null&&o.id&&chrome.runtime.sendMessage({type:"log",text:`[Webtoons] ${t}`},()=>{chrome.runtime.lastError})}function w(){if(document.getElementById("bmh-webtoons-styles"))return;const e=document.createElement("style");e.id="bmh-webtoons-styles",e.textContent=`
        @keyframes bmh-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
    `,document.head.appendChild(e),y.injectStyles()}async function h(){var s;if(!((s=chrome.runtime)!=null&&s.id))return;l("Webtoons CardEnhancer v3.8.0 (Bundled) initializing..."),w();const e=await new Promise(i=>{chrome.storage.local.get(["WebtoonsHighlightEnabled","WebtoonsQuickActionsEnabled","CustomBorderSize","CustomBorderSizefeatureEnabled","CustomBookmarksfeatureEnabled","customBookmarks","WebtoonsShowProgress"],a=>{if(chrome.runtime.lastError){i({});return}i(a)})});if(e.WebtoonsHighlightEnabled===!1){l("Highlighting disabled");return}const t=new b(d,{highlighting:!0,progressBadges:e.WebtoonsShowProgress!==!1,quickActions:e.WebtoonsQuickActionsEnabled!==!1,CustomBorderSize:e.CustomBorderSizefeatureEnabled?e.CustomBorderSize:4,CustomBookmarksfeatureEnabled:e.CustomBookmarksfeatureEnabled,customBookmarks:e.customBookmarks}),o=t.findCards();l(`Found ${o.length} potential cards`),o.length>0&&l(`Sample card data: ${JSON.stringify(o[0].data)}`);const r=await t.enhanceAll();l(`Enhanced ${r} cards (Quick Actions: ${e.WebtoonsQuickActionsEnabled!==!1?"ON":"OFF"})`),location.href.includes("episode_no")&&(f(),new g(d).init(),l("Reader enhancements initialized")),new MutationObserver(()=>{t.enhanceAll()}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>setTimeout(h,800)):setTimeout(h,500);window.addEventListener("load",()=>setTimeout(h,500));let m=location.href;const S=new MutationObserver(()=>{var e;(e=chrome.runtime)!=null&&e.id&&location.href!==m&&(m=location.href,document.querySelectorAll("[data-bmh-enhanced]").forEach(t=>{delete t.dataset.bmhEnhanced}),setTimeout(h,500),location.href.includes("episode_no")&&setTimeout(f,1e3))});S.observe(document,{subtree:!0,childList:!0});
