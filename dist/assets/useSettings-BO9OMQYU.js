import{F as f,S as R,B as T,T as y,C}from"./config-sTLp4FTN.js";import{w as _,b as B,i as U,e as p,r as n,S as o}from"./storage-schema-DbDZlffU.js";function K(){const b=n(!1),h=n(!0),u=n("cloudy-dark"),d=n({...R}),c=n({...T}),a=n({...f}),v=n("medium"),m=n([]),l=n({}),E=p(()=>y[u.value]||y["cloudy-dark"]),k=p(()=>C[v.value]||C.medium),P=p(()=>Object.entries(y).map(([e,t])=>({id:e,name:t.name}))),r=n({general:{markHomePage:!1,syncAndMarkRead:!1,familyFriendly:!1},automation:{smartAutoComplete:!1,smartInactivityFade:!1,smartResumeLink:!1,notificationsEnabled:!1},reader:{enhancements:!0,autoScrollEnabled:!1,keybindsEnabled:!1,progressTrackingEnabled:!1,widthFix:!1,nextChapter:!0},highlights:{mangadex:!0,webtoons:!0},platforms:{mangadex:{highlight:!0,showProgress:!0},webtoons:{highlight:!0,showProgress:!0}},appearance:{theme:"cloudy-dark",accentColor:"",libraryData:{progressBars:!0}},dates:{}});async function S(){h.value=!0;try{const e=await chrome.storage.local.get([o.THEME,o.STATUS_COLORS,o.BORDER_STYLE,o.BORDER_SIZE,o.CUSTOM_MARKERS,"features","cardSize","platformSettings"]);e[o.THEME]&&(u.value=e[o.THEME]),e.features&&(a.value={...f,...e.features}),e.platformSettings&&(l.value=e.platformSettings||{}),r.value.general.markHomePage=a.value.markHomePage,r.value.general.syncAndMarkRead=a.value.syncAndMarkRead,r.value.general.familyFriendly=a.value.familyFriendly,r.value.automation.smartAutoComplete=a.value.smartAutoComplete,r.value.automation.smartInactivityFade=a.value.smartInactivityDim,r.value.automation.smartResumeLink=a.value.smartResume,r.value.automation.notificationsEnabled=a.value.notifications,r.value.reader.enhancements=a.value.readerEnhancements,r.value.reader.widthFix=a.value.readerWidthFix,r.value.reader.nextChapter=a.value.readerNextChapter,r.value.reader.autoScrollEnabled=a.value.autoScroll,r.value.reader.keybindsEnabled=a.value.keyboardShortcuts,r.value.reader.progressTrackingEnabled=a.value.progressBadges,r.value.highlights.mangadex=a.value.mangadexHighlight,r.value.highlights.webtoons=a.value.webtoonsHighlight,l.value.mangadex||(l.value.mangadex={highlight:a.value.mangadexHighlight,showProgress:!0}),l.value.webtoons||(l.value.webtoons={highlight:a.value.webtoonsHighlight,showProgress:!0}),r.value.platforms=JSON.parse(JSON.stringify(l.value)),r.value.platforms.mangadex.highlight=l.value.mangadex.highlight??!0,r.value.platforms.mangadex.showProgress=l.value.mangadex.showProgress??!0,r.value.platforms.webtoons.highlight=l.value.webtoons.highlight??!0,r.value.platforms.webtoons.showProgress=l.value.webtoons.showProgress??!0,r.value.appearance.theme=u.value,r.value.appearance.libraryData.progressBars=a.value.progressBadges,b.value=!0,console.log("[useSettings] ✓ Settings loaded")}catch(e){console.error("[useSettings] Failed to load settings:",e)}finally{h.value=!1}}async function w(e){a.value.markHomePage=e.general.markHomePage,a.value.syncAndMarkRead=e.general.syncAndMarkRead,a.value.familyFriendly=e.general.familyFriendly,a.value.smartAutoComplete=e.automation.smartAutoComplete,a.value.smartInactivityDim=e.automation.smartInactivityFade,a.value.smartResume=e.automation.smartResumeLink,a.value.notifications=e.automation.notificationsEnabled,a.value.readerEnhancements=e.reader.enhancements,a.value.readerWidthFix=e.reader.widthFix,a.value.readerNextChapter=e.reader.nextChapter,a.value.autoScroll=e.reader.autoScrollEnabled,a.value.keyboardShortcuts=e.reader.keybindsEnabled,a.value.mangadexHighlight=e.highlights.mangadex,a.value.webtoonsHighlight=e.highlights.webtoons,a.value.progressBadges=e.appearance.libraryData.progressBars,l.value.mangadex=e.platforms.mangadex,l.value.webtoons=e.platforms.webtoons,a.value.mangadexHighlight=e.platforms.mangadex.highlight,a.value.webtoonsHighlight=e.platforms.webtoons.highlight,u.value=e.appearance.theme,await i()}async function i(){try{await chrome.storage.local.set({[o.THEME]:u.value,[o.STATUS_COLORS]:d.value,[o.BORDER_STYLE]:c.value.style,[o.BORDER_SIZE]:c.value.size,[o.CUSTOM_MARKERS]:m.value,features:a.value,cardSize:v.value,platformSettings:l.value}),console.log("[useSettings] ✓ Settings saved")}catch(e){console.error("[useSettings] Failed to save settings:",e)}}async function A(e,t){const s=e.split(".");s.length===1?e==="theme"?u.value=t:e==="cardSize"&&(v.value=t):s[0]==="border"?c.value[s[1]]=t:s[0]==="features"?a.value[s[1]]=t:s[0]==="statusColors"?d.value[s[1]]=t:s[0]==="platforms"&&s.length===3&&(l.value[s[1]]||(l.value[s[1]]={}),l.value[s[1]][s[2]]=t),await i()}function F(e){return d.value[e]||"transparent"}function M(e){return a.value[e]??!1}async function O(e){a.value[e]=!a.value[e],await i()}async function H(e,t){m.value.push({name:e,color:t}),await i()}async function L(e){m.value=m.value.filter(t=>t.name!==e),await i()}function g(){const e=E.value,t=document.documentElement;t.style.setProperty("--color-bg-body",e.bgBody),t.style.setProperty("--color-bg-sidebar",e.bgSidebar),t.style.setProperty("--color-bg-surface",e.bgSurface),t.style.setProperty("--color-bg-elevated",e.bgElevated),t.style.setProperty("--color-primary",e.accentPrimary),t.style.setProperty("--color-accent",e.accentSecondary),t.style.setProperty("--color-text-primary",e.textPrimary),t.style.setProperty("--color-text-secondary",e.textSecondary),t.style.setProperty("--color-text-muted",e.textMuted),t.style.setProperty("--color-border",e.border)}async function D(){u.value="cloudy-dark",d.value={...R},c.value={...T},a.value={...f},v.value="medium",m.value=[],await i(),g()}function x(e,t){t==="local"&&(e[o.THEME]&&(u.value=e[o.THEME].newValue,g()),e[o.STATUS_COLORS]&&(d.value=e[o.STATUS_COLORS].newValue),e.features&&(a.value=e.features.newValue))}return _(u,()=>{g()}),B(async()=>{await S(),g(),chrome.storage.onChanged.addListener(x)}),U(()=>{chrome.storage.onChanged.removeListener(x)}),{settings:r,isLoaded:b,isLoading:h,theme:u,statusColors:d,border:c,features:a,cardSize:v,customMarkers:m,platforms:l,themeConfig:E,cardDimensions:k,availableThemes:P,loadSettings:S,saveSettings:i,updateSettings:w,updateSetting:A,getStatusColor:F,isFeatureEnabled:M,toggleFeature:O,addCustomMarker:H,removeCustomMarker:L,applyTheme:g,resetToDefaults:D}}export{K as u};
