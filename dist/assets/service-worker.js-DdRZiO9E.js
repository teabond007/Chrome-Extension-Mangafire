chrome.runtime.onInstalled.addListener(e=>{console.log("[MangaManager] Extension installed/updated:",e.reason),e.reason==="install"&&chrome.storage.local.set({extensionEnabled:!0,dashboardEnabled:!0,autoSync:!0,notificationsEnabled:!1,libraryEntries:{}})});chrome.runtime.onMessage.addListener((e,r,a)=>{switch(console.log("[MangaManager] Message received:",e.type),e.type){case"GET_SETTINGS":return n(a),!0;case"UPDATE_READING_PROGRESS":return s(e.data,a),!0;case"SYNC_BOOKMARKS":return c(a),!0;default:console.warn("[MangaManager] Unknown message type:",e.type),a({success:!1,error:"Unknown message type"})}});async function n(e){try{const r=await chrome.storage.local.get(["extensionEnabled","dashboardEnabled","autoSync"]);e({success:!0,data:r})}catch(r){e({success:!1,error:r.message})}}async function s(e,r){try{const{libraryEntries:a}=await chrome.storage.local.get("libraryEntries"),t=a||{};t[e.id]&&(t[e.id]={...t[e.id],lastChapter:e.chapter,lastReadAt:Date.now(),lastReadUrl:e.url},await chrome.storage.local.set({libraryEntries:t})),r({success:!0})}catch(a){r({success:!1,error:a.message})}}async function c(e){try{console.log("[MangaManager] Bookmark sync triggered"),e({success:!0,message:"Sync complete"})}catch(r){e({success:!1,error:r.message})}}console.log("[MangaManager] Background service worker initialized");
