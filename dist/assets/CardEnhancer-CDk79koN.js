import{_ as x,c as b,g,a,x as h,d as c,n as k,y as m,t as y,F as C,i as w,f as R,r as S,z as v}from"./_plugin-vue_export-helper-DrK4Gf5m.js";import{C as L}from"./config-0i2jtrsc.js";import{S as u,c as B}from"./storage-schema-CQTxiJkW.js";const A=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.overlay-container{display:contents}.quick-tooltip{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transform:translateY(-4px);transition:all .2s cubic-bezier(.4,0,.2,1);z-index:60;pointer-events:none}:host([visible]) .quick-tooltip,:host(:hover) .quick-tooltip{opacity:1;transform:translateY(0);pointer-events:auto}.action-btn{width:28px;height:28px;border:none;border-radius:6px;background:#000000d9;color:#fff;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s ease;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);box-shadow:0 2px 8px #0006;padding:0}.action-btn:hover{transform:scale(1.1);background:#1e1e1ef2}.action-btn.disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.continue-btn{background:linear-gradient(135deg,#4caf50,#388e3c)}.continue-btn:hover:not(.disabled){background:linear-gradient(135deg,#66bb6a,#43a047)}.status-btn .status-dot{width:10px;height:10px;border-radius:50%;background-color:var(--status-color)}.rating-btn{color:#fbbf24}",q={class:"overlay-container"},I={class:"quick-tooltip"},_=["title"],z=["title"],M=["title"],O={__name:"QuickActionsOverlay.ce",props:{entry:{type:Object,required:!0},statusColors:{type:Object,default:()=>({Reading:"#4ade80",Completed:"#60a5fa","Plan to Read":"#fbbf24","On-Hold":"#f97316",Dropped:"#ef4444","Re-reading":"#a855f7"})}},emits:["continue","open-status","open-rating","details"],setup(p,{emit:t}){const e=p,o=c(()=>e.entry.status||"Plan to Read"),s=c(()=>{var d;return((d=e.entry.personalData)==null?void 0:d.rating)||0}),r=c(()=>e.entry.lastReadChapter?parseFloat(e.entry.lastReadChapter):0),i=c(()=>!0),n=c(()=>r.value>0?r.value+1:1),$=c(()=>r.value>0?`Continue Ch. ${n.value}`:"Start Reading"),E=c(()=>e.statusColors[o.value]||"#9ca3af");return(d,l)=>(g(),b("div",q,[a("div",I,[a("button",{class:k(["action-btn continue-btn",{disabled:!i.value}]),title:$.value,onClick:l[0]||(l[0]=h(f=>d.$emit("continue"),["stop"]))},[...l[4]||(l[4]=[a("span",{class:"icon"},"▶",-1)])],10,_),a("button",{class:"action-btn status-btn",title:o.value,style:m({"--status-color":E.value}),onClick:l[1]||(l[1]=h(f=>d.$emit("open-status",f),["stop"]))},[...l[5]||(l[5]=[a("span",{class:"status-dot"},null,-1)])],12,z),a("button",{class:"action-btn rating-btn",title:`Rating: ${s.value}/10`,onClick:l[2]||(l[2]=h(f=>d.$emit("open-rating",f),["stop"]))},y(s.value>0?s.value:"★"),9,M),a("button",{class:"action-btn info-btn",title:"View Details",onClick:l[3]||(l[3]=h(f=>d.$emit("details"),["stop"]))}," ℹ ")])]))}},Y=x(O,[["styles",[A]]]),F=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.picker-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999}.picker-container{position:absolute;background:#141419fa;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;min-width:180px;box-shadow:0 12px 40px #0009;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);animation:picker-slide .2s cubic-bezier(.2,.8,.2,1);display:flex;flex-direction:column;gap:8px}@keyframes picker-slide{0%{opacity:0;transform:scale(.95) translateY(-8px)}to{opacity:1;transform:scale(1) translateY(0)}}.picker-header{font-size:11px;color:#ffffff80;text-transform:uppercase;letter-spacing:1px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.08);font-weight:600}.picker-options{display:flex;flex-direction:column;gap:4px}.picker-option{display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;background:transparent;border:none;border-radius:8px;color:#fff;font-size:13px;cursor:pointer;transition:all .15s ease;text-align:left;font-family:inherit}.picker-option:hover{background:#ffffff1a}.picker-option.active{background:#ffffff26;font-weight:500}.status-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}",P={class:"picker-options"},U=["onClick"],j={__name:"StatusPicker.ce",props:{currentStatus:{type:String,default:""},position:{type:Object,default:()=>({top:0,left:0})},statusColors:{type:Object,required:!0}},emits:["select","close"],setup(p){const t=p,e=c(()=>Object.entries(t.statusColors).map(([s,r])=>({name:s,color:r})).filter(s=>s.name!=="HasHistory")),o=c(()=>({top:`${t.position.top}px`,left:`${t.position.left}px`}));return(s,r)=>(g(),b("div",{class:"picker-overlay",onClick:r[0]||(r[0]=h(i=>s.$emit("close"),["self"]))},[a("div",{class:"picker-container",style:m(o.value)},[r[1]||(r[1]=a("div",{class:"picker-header"},"Change Status",-1)),a("div",P,[(g(!0),b(C,null,w(e.value,i=>(g(),b("button",{key:i.name,class:k(["picker-option",{active:p.currentStatus===i.name}]),onClick:n=>s.$emit("select",i.name)},[a("span",{class:"status-dot",style:m({background:i.color})},null,4),R(" "+y(i.name),1)],10,U))),128))])],4)]))}},V=x(j,[["styles",[F]]]),T=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.picker-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999}.picker-container{position:absolute;background:#141419fa;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;min-width:180px;box-shadow:0 12px 40px #0009;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);animation:picker-slide .2s cubic-bezier(.2,.8,.2,1)}@keyframes picker-slide{0%{opacity:0;transform:scale(.95) translateY(-8px)}to{opacity:1;transform:scale(1) translateY(0)}}.picker-header{font-size:11px;color:#ffffff80;text-transform:uppercase;letter-spacing:1px;padding-bottom:8px;margin-bottom:8px;border-bottom:1px solid rgba(255,255,255,.08);font-weight:600}.rating-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-bottom:10px}.rating-num{width:36px;height:36px;border:1px solid rgba(255,255,255,.15);border-radius:8px;background:transparent;color:#fff;font-size:14px;font-weight:600;cursor:pointer;transition:all .15s ease;padding:0;display:flex;align-items:center;justify-content:center;font-family:inherit}.rating-num:hover,.rating-num.hovered{background:#fbbf244d;border-color:#fbbf24;color:#fbbf24}.rating-num.active{background:#fbbf24;border-color:#fbbf24;color:#000}.rating-clear{width:100%;padding:8px;background:transparent;border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#fff9;font-size:12px;cursor:pointer;transition:all .15s ease;font-family:inherit}.rating-clear:hover{background:#ffffff14;color:#fff}",D={class:"rating-grid"},Q=["onMouseenter","onClick"],N={__name:"RatingPicker.ce",props:{currentRating:{type:Number,default:0},position:{type:Object,default:()=>({top:0,left:0})}},emits:["select","close"],setup(p){const t=p,e=S(null),o=c(()=>({top:`${t.position.top}px`,left:`${t.position.left}px`}));return(s,r)=>(g(),b("div",{class:"picker-overlay",onClick:r[1]||(r[1]=h(i=>s.$emit("close"),["self"]))},[a("div",{class:"picker-container",style:m(o.value)},[r[2]||(r[2]=a("div",{class:"picker-header"},"Rate (1-10)",-1)),a("div",D,[(g(),b(C,null,w(10,i=>a("button",{key:i,class:k(["rating-num",{active:p.currentRating===i,hovered:e.value!==null&&i<=e.value}]),onMouseenter:n=>e.value=i,onClick:n=>s.$emit("select",i)},y(i),43,Q)),64))]),a("button",{class:"rating-clear",onClick:r[0]||(r[0]=i=>s.$emit("select",0))}," Clear Rating ")],4)]))}},H=x(N,[["styles",[T]]]),J=v(Y);customElements.get("bmh-quick-actions")||customElements.define("bmh-quick-actions",J);const K=v(V);customElements.get("bmh-status-picker")||customElements.define("bmh-status-picker",K);const G=v(H);customElements.get("bmh-rating-picker")||customElements.define("bmh-rating-picker",G);class tt{constructor(t){this.adapter=t,this.settings={highlighting:!0,quickActions:!0},this.library=new Map,this.observer=null,this.config=null}async init(){console.log(`[CardEnhancer] Initializing for ${this.adapter.name}...`),await this.loadSettings(),await this.loadLibrary(),this.enhanceVisibleCards(),this.startObserver(),chrome.storage.onChanged.addListener((t,e)=>{e==="local"&&(t[u.LIBRARY]&&this.loadLibrary().then(()=>this.enhanceVisibleCards()),(t.features||t.statusColors)&&this.loadSettings().then(()=>this.enhanceVisibleCards()))})}async loadSettings(){this.config=await L.load(),this.settings.highlighting=this.config.isFeatureEnabled("highlighting"),this.settings.quickActions=this.config.isFeatureEnabled("quickActions")}async loadLibrary(){const e=(await chrome.storage.local.get(u.LIBRARY))[u.LIBRARY]||[];this.library.clear(),e.forEach(o=>{o.sourceId&&this.library.set(`${o.source}:${o.sourceId}`,o),o.slug&&this.library.set(`${o.source}:${o.slug}`,o),o.slug&&o.source===this.adapter.id&&this.library.set(o.slug,o)})}startObserver(){this.observer=new MutationObserver(t=>{let e=!1;for(const o of t)if(o.addedNodes.length>0){e=!0;break}e&&(this._debounce&&clearTimeout(this._debounce),this._debounce=setTimeout(()=>this.enhanceVisibleCards(),200))}),this.observer.observe(document.body,{childList:!0,subtree:!0})}enhanceVisibleCards(){const t=this.adapter.selectors.card;if(!t)return;document.querySelectorAll(t).forEach(o=>this.enhanceCard(o))}enhanceCard(t){if(t.dataset.bmhEnhanced)return;const e=this.adapter.extractCardData(t);if(!e||!e.id&&!e.title)return;const o=this.findMatch(e);t.dataset.bmhEnhanced="true",t.addEventListener("mouseenter",()=>{const s=t.querySelector("bmh-quick-actions");s&&s.setAttribute("visible","")}),t.addEventListener("mouseleave",()=>{const s=t.querySelector("bmh-quick-actions");s&&s.removeAttribute("visible")}),this.settings.highlighting&&o&&this.applyBorder(t,o),this.settings.quickActions&&this.mountQuickActions(t,o||this.createTemporaryEntry(e))}findMatch(t){if(t.id){const e=`${this.adapter.id}:${t.id}`;if(this.library.has(e))return this.library.get(e)}if(t.slug){const e=`${this.adapter.id}:${t.slug}`;if(this.library.has(e))return this.library.get(e);if(this.library.has(t.slug))return this.library.get(t.slug)}return null}createTemporaryEntry(t){return{id:t.id,title:t.title,slug:t.slug,status:null,source:this.adapter.id,sourceUrl:t.url,lastReadChapter:null,personalData:{rating:0}}}applyBorder(t,e){const o=this.config?this.config.getStatusColor(e.status):"transparent";this.adapter.applyBorder?this.adapter.applyBorder(t,o):(t.style.border=`3px solid ${o}`,t.style.borderRadius="8px")}mountQuickActions(t,e){const o=document.createElement("bmh-quick-actions");o.entry=e,o.statusColors=this.config?this.config.statusColors:{},getComputedStyle(t).position==="static"&&(t.style.position="relative"),o.addEventListener("continue",()=>this.handleContinue(e)),o.addEventListener("open-status",s=>this.handleStatus(s,e)),o.addEventListener("open-rating",s=>this.handleRating(s,e)),o.addEventListener("details",()=>this.handleDetails(e)),t.appendChild(o)}handleContinue(t){t.lastReadUrl?window.location.href=t.lastReadUrl:t.sourceUrl&&(window.location.href=t.sourceUrl)}handleStatus(t,e){const o=t.target.getBoundingClientRect();this.mountPicker("bmh-status-picker",{currentStatus:e.status,statusColors:this.config.statusColors,position:{top:o.bottom+8,left:o.left}},s=>{this.updateLibraryEntry(e,{status:s})})}handleRating(t,e){var s;const o=t.target.getBoundingClientRect();this.mountPicker("bmh-rating-picker",{currentRating:((s=e.personalData)==null?void 0:s.rating)||0,position:{top:o.bottom+8,left:o.left}},r=>{const i=e.personalData||{};i.rating=r,this.updateLibraryEntry(e,{personalData:i})})}mountPicker(t,e,o){document.querySelectorAll("bmh-status-picker, bmh-rating-picker").forEach(r=>r.remove());const s=document.createElement(t);Object.assign(s,e),s.addEventListener("select",r=>{o(r.detail[0]),s.remove()}),s.addEventListener("close",()=>s.remove()),document.body.appendChild(s)}async updateLibraryEntry(t,e){var i;let s=(await chrome.storage.local.get(u.LIBRARY))[u.LIBRARY]||[];const r=s.findIndex(n=>n.source===t.source&&n.sourceId===t.id||n.slug&&n.slug===t.slug&&n.source===t.source);if(r!==-1)s[r]={...s[r],...e};else{if(!e.status&&!((i=e.personalData)!=null&&i.rating))return;const n=B({...t,...e});s.push(n)}await chrome.storage.local.set({[u.LIBRARY]:s}),console.log(`[CardEnhancer] Updated entry: ${t.title}`,e)}handleDetails(t){console.log("Details for",t),t.sourceUrl&&window.open(t.sourceUrl,"_blank")}}export{tt as C};
