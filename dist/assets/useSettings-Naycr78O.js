import{S as E,F as y,B as _,T as m,C}from"./config-C-HYl_Rw.js";import{w as B,b as z,z as F,e as g,r as s,S as a}from"./storage-schema-5IIhgyd6.js";function I(){const T=s(!1),v=s(!0),l=s("cloudy-dark"),n=s({...E}),u=s({..._}),r=s({...y}),c=s("medium"),i=s([]),S=s({}),R=g(()=>m[l.value]||m["cloudy-dark"]),M=g(()=>C[c.value]||C.medium),b=g(()=>Object.entries(m).map(([e,t])=>({id:e,name:t.name})));async function p(){v.value=!0;try{const e=await chrome.storage.local.get([a.THEME,a.STATUS_COLORS,a.BORDER_STYLE,a.BORDER_SIZE,a.CUSTOM_MARKERS,"features","cardSize"]);e[a.THEME]&&(l.value=e[a.THEME]),e[a.STATUS_COLORS]&&(n.value={...E,...e[a.STATUS_COLORS]}),e[a.BORDER_STYLE]&&(u.value.style=e[a.BORDER_STYLE]),e[a.BORDER_SIZE]&&(u.value.size=e[a.BORDER_SIZE]),e[a.CUSTOM_MARKERS]&&(i.value=e[a.CUSTOM_MARKERS]),e.features&&(r.value={...y,...e.features}),e.cardSize&&(c.value=e.cardSize),e.platformSettings&&(S.value=e.platformSettings),T.value=!0,console.log("[useSettings] ✓ Settings loaded")}catch(e){console.error("[useSettings] Failed to load settings:",e)}finally{v.value=!1}}async function f(){try{await chrome.storage.local.set({[a.THEME]:l.value,[a.STATUS_COLORS]:n.value,[a.BORDER_STYLE]:u.value.style,[a.BORDER_SIZE]:u.value.size,[a.CUSTOM_MARKERS]:i.value,features:r.value,cardSize:c.value,platformSettings:S.value}),console.log("[useSettings] ✓ Settings saved")}catch(e){console.error("[useSettings] Failed to save settings:",e)}}async function L(e,t){const o=e.split(".");o.length===1?e==="theme"?l.value=t:e==="cardSize"&&(c.value=t):o[0]==="border"?u.value[o[1]]=t:o[0]==="features"?r.value[o[1]]=t:o[0]==="statusColors"?n.value[o[1]]=t:o[0]==="platforms"&&o.length===3&&(S.value[o[1]]||(S.value[o[1]]={}),S.value[o[1]][o[2]]=t),await f()}function A(e){return n.value[e]||"transparent"}function U(e){return r.value[e]??!1}async function h(e){r.value[e]=!r.value[e],await f()}async function D(e,t){i.value.push({name:e,color:t}),await f()}async function w(e){i.value=i.value.filter(t=>t.name!==e),await f()}function d(){const e=R.value,t=document.documentElement;t.style.setProperty("--color-bg-body",e.bgBody),t.style.setProperty("--color-bg-sidebar",e.bgSidebar),t.style.setProperty("--color-bg-surface",e.bgSurface),t.style.setProperty("--color-bg-elevated",e.bgElevated),t.style.setProperty("--color-primary",e.accentPrimary),t.style.setProperty("--color-accent",e.accentSecondary),t.style.setProperty("--color-text-primary",e.textPrimary),t.style.setProperty("--color-text-secondary",e.textSecondary),t.style.setProperty("--color-text-muted",e.textMuted),t.style.setProperty("--color-border",e.border)}async function P(){l.value="cloudy-dark",n.value={...E},u.value={..._},r.value={...y},c.value="medium",i.value=[],await f(),d()}function O(e,t){t==="local"&&(e[a.THEME]&&(l.value=e[a.THEME].newValue,d()),e[a.STATUS_COLORS]&&(n.value=e[a.STATUS_COLORS].newValue),e.features&&(r.value=e.features.newValue))}return B(l,()=>{d()}),z(async()=>{await p(),d(),chrome.storage.onChanged.addListener(O)}),F(()=>{chrome.storage.onChanged.removeListener(O)}),{isLoaded:T,isLoading:v,theme:l,statusColors:n,border:u,features:r,cardSize:c,customMarkers:i,platforms:S,themeConfig:R,cardDimensions:M,availableThemes:b,loadSettings:p,saveSettings:f,updateSetting:L,getStatusColor:A,isFeatureEnabled:U,toggleFeature:h,addCustomMarker:D,removeCustomMarker:w,applyTheme:d,resetToDefaults:P}}export{I as u};
