import{_ as $,c as b,g as m,a as l,x as y,d as h,n as w,y as R,t as S,F as B,i as P,f as T,r as E,z as I}from"./_plugin-vue_export-helper-DrK4Gf5m.js";import{C as z}from"./config-0i2jtrsc.js";import{S as v,c as q}from"./storage-schema-CQTxiJkW.js";const F=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.overlay-container{display:contents}.quick-tooltip{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transform:translateY(-4px);transition:all .2s cubic-bezier(.4,0,.2,1);z-index:60;pointer-events:none}:host([visible]) .quick-tooltip,:host(:hover) .quick-tooltip{opacity:1;transform:translateY(0);pointer-events:auto}.action-btn{width:28px;height:28px;border:none;border-radius:6px;background:#000000d9;color:#fff;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s ease;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);box-shadow:0 2px 8px #0006;padding:0}.action-btn:hover{transform:scale(1.1);background:#1e1e1ef2}.action-btn.disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.continue-btn{background:linear-gradient(135deg,#4caf50,#388e3c)}.continue-btn:hover:not(.disabled){background:linear-gradient(135deg,#66bb6a,#43a047)}.status-btn .status-dot{width:10px;height:10px;border-radius:50%;background-color:var(--status-color)}.rating-btn{color:#fbbf24}",Y={class:"overlay-container"},U={class:"quick-tooltip"},D=["title"],N=["title"],O=["title"],j={__name:"QuickActionsOverlay.ce",props:{entry:{type:Object,required:!0},statusColors:{type:Object,default:()=>({Reading:"#4ade80",Completed:"#60a5fa","Plan to Read":"#fbbf24","On-Hold":"#f97316",Dropped:"#ef4444","Re-reading":"#a855f7"})}},emits:["continue","open-status","open-rating","details"],setup(g,{emit:t}){const e=g,o=h(()=>e.entry.status||"Plan to Read"),s=h(()=>{var c;return((c=e.entry.personalData)==null?void 0:c.rating)||0}),r=h(()=>e.entry.lastReadChapter?parseFloat(e.entry.lastReadChapter):0),a=h(()=>!0),i=h(()=>r.value>0?r.value+1:1),p=h(()=>r.value>0?`Continue Ch. ${i.value}`:"Start Reading"),x=h(()=>e.statusColors[o.value]||"#9ca3af");return(c,n)=>(m(),b("div",Y,[l("div",U,[l("button",{class:w(["action-btn continue-btn",{disabled:!a.value}]),title:p.value,onClick:n[0]||(n[0]=y(u=>c.$emit("continue"),["stop"]))},[...n[4]||(n[4]=[l("span",{class:"icon"},"▶",-1)])],10,D),l("button",{class:"action-btn status-btn",title:o.value,style:R({"--status-color":x.value}),onClick:n[1]||(n[1]=y(u=>c.$emit("open-status",u),["stop"]))},[...n[5]||(n[5]=[l("span",{class:"status-dot"},null,-1)])],12,N),l("button",{class:"action-btn rating-btn",title:`Rating: ${s.value}/10`,onClick:n[2]||(n[2]=y(u=>c.$emit("open-rating",u),["stop"]))},S(s.value>0?s.value:"★"),9,O),l("button",{class:"action-btn info-btn",title:"View Details",onClick:n[3]||(n[3]=y(u=>c.$emit("details"),["stop"]))}," ℹ ")])]))}},V=$(j,[["styles",[F]]]),K=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.picker-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999}.picker-container{position:absolute;background:#141419fa;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;min-width:180px;box-shadow:0 12px 40px #0009;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);animation:picker-slide .2s cubic-bezier(.2,.8,.2,1);display:flex;flex-direction:column;gap:8px}@keyframes picker-slide{0%{opacity:0;transform:scale(.95) translateY(-8px)}to{opacity:1;transform:scale(1) translateY(0)}}.picker-header{font-size:11px;color:#ffffff80;text-transform:uppercase;letter-spacing:1px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.08);font-weight:600}.picker-options{display:flex;flex-direction:column;gap:4px}.picker-option{display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;background:transparent;border:none;border-radius:8px;color:#fff;font-size:13px;cursor:pointer;transition:all .15s ease;text-align:left;font-family:inherit}.picker-option:hover{background:#ffffff1a}.picker-option.active{background:#ffffff26;font-weight:500}.status-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}",H={class:"picker-options"},Q=["onClick"],J={__name:"StatusPicker.ce",props:{currentStatus:{type:String,default:""},position:{type:Object,default:()=>({top:0,left:0})},statusColors:{type:Object,required:!0}},emits:["select","close"],setup(g){const t=g,e=h(()=>Object.entries(t.statusColors).map(([s,r])=>({name:s,color:r})).filter(s=>s.name!=="HasHistory")),o=h(()=>({top:`${t.position.top}px`,left:`${t.position.left}px`}));return(s,r)=>(m(),b("div",{class:"picker-overlay",onClick:r[0]||(r[0]=y(a=>s.$emit("close"),["self"]))},[l("div",{class:"picker-container",style:R(o.value)},[r[1]||(r[1]=l("div",{class:"picker-header"},"Change Status",-1)),l("div",H,[(m(!0),b(B,null,P(e.value,a=>(m(),b("button",{key:a.name,class:w(["picker-option",{active:g.currentStatus===a.name}]),onClick:i=>s.$emit("select",a.name)},[l("span",{class:"status-dot",style:R({background:a.color})},null,4),T(" "+S(a.name),1)],10,Q))),128))])],4)]))}},X=$(J,[["styles",[K]]]),G=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}:root{--shadow-sm: 0 1px 2px rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px rgba(0, 0, 0, .35);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .4);--shadow-xl: 0 20px 25px rgba(0, 0, 0, .45);--glow-primary: 0 0 20px rgba(100, 150, 255, .3);--glow-accent: 0 0 20px rgba(180, 100, 255, .3)}.picker-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999}.picker-container{position:absolute;background:#141419fa;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;min-width:180px;box-shadow:0 12px 40px #0009;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);animation:picker-slide .2s cubic-bezier(.2,.8,.2,1)}@keyframes picker-slide{0%{opacity:0;transform:scale(.95) translateY(-8px)}to{opacity:1;transform:scale(1) translateY(0)}}.picker-header{font-size:11px;color:#ffffff80;text-transform:uppercase;letter-spacing:1px;padding-bottom:8px;margin-bottom:8px;border-bottom:1px solid rgba(255,255,255,.08);font-weight:600}.rating-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-bottom:10px}.rating-num{width:36px;height:36px;border:1px solid rgba(255,255,255,.15);border-radius:8px;background:transparent;color:#fff;font-size:14px;font-weight:600;cursor:pointer;transition:all .15s ease;padding:0;display:flex;align-items:center;justify-content:center;font-family:inherit}.rating-num:hover,.rating-num.hovered{background:#fbbf244d;border-color:#fbbf24;color:#fbbf24}.rating-num.active{background:#fbbf24;border-color:#fbbf24;color:#000}.rating-clear{width:100%;padding:8px;background:transparent;border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#fff9;font-size:12px;cursor:pointer;transition:all .15s ease;font-family:inherit}.rating-clear:hover{background:#ffffff14;color:#fff}",W={class:"rating-grid"},Z=["onMouseenter","onClick"],tt={__name:"RatingPicker.ce",props:{currentRating:{type:Number,default:0},position:{type:Object,default:()=>({top:0,left:0})}},emits:["select","close"],setup(g){const t=g,e=E(null),o=h(()=>({top:`${t.position.top}px`,left:`${t.position.left}px`}));return(s,r)=>(m(),b("div",{class:"picker-overlay",onClick:r[1]||(r[1]=y(a=>s.$emit("close"),["self"]))},[l("div",{class:"picker-container",style:R(o.value)},[r[2]||(r[2]=l("div",{class:"picker-header"},"Rate (1-10)",-1)),l("div",W,[(m(),b(B,null,P(10,a=>l("button",{key:a,class:w(["rating-num",{active:g.currentRating===a,hovered:e.value!==null&&a<=e.value}]),onMouseenter:i=>e.value=a,onClick:i=>s.$emit("select",a)},S(a),43,Z)),64))]),l("button",{class:"rating-clear",onClick:r[0]||(r[0]=a=>s.$emit("select",0))}," Clear Rating ")],4)]))}},et=$(tt,[["styles",[G]]]),ot=I(V);customElements.get("bmh-quick-actions")||customElements.define("bmh-quick-actions",ot);const st=I(X);customElements.get("bmh-status-picker")||customElements.define("bmh-status-picker",st);const rt=I(et);customElements.get("bmh-rating-picker")||customElements.define("bmh-rating-picker",rt);class ft{constructor(t){this.adapter=t,this.settings={highlighting:!0,quickActions:!0},this.library=new Map,this.observer=null,this.config=null}async init(){console.log(`[CardEnhancer] Initializing for ${this.adapter.name}...`),await this.loadSettings(),await this.loadLibrary(),this.enhanceVisibleCards(),this.startObserver(),chrome.storage.onChanged.addListener((t,e)=>{e==="local"&&(t[v.LIBRARY]&&this.loadLibrary().then(()=>this.enhanceVisibleCards()),(t.features||t.statusColors)&&this.loadSettings().then(()=>this.enhanceVisibleCards()))})}async loadSettings(){this.config=await z.load(),this.settings.highlighting=this.config.isFeatureEnabled("highlighting"),this.settings.quickActions=this.config.isFeatureEnabled("quickActions")}async loadLibrary(){const e=(await chrome.storage.local.get(v.LIBRARY))[v.LIBRARY]||[];this.library.clear(),e.forEach(o=>{o.sourceId&&this.library.set(`${o.source}:${o.sourceId}`,o),o.slug&&this.library.set(`${o.source}:${o.slug}`,o),o.slug&&o.source===this.adapter.id&&this.library.set(o.slug,o)})}startObserver(){this.observer=new MutationObserver(t=>{let e=!1;for(const o of t)if(o.addedNodes.length>0){e=!0;break}e&&(this._debounce&&clearTimeout(this._debounce),this._debounce=setTimeout(()=>this.enhanceVisibleCards(),200))}),this.observer.observe(document.body,{childList:!0,subtree:!0})}enhanceVisibleCards(){const t=this.adapter.selectors.card;if(!t)return;document.querySelectorAll(t).forEach(o=>this.enhanceCard(o))}enhanceCard(t){if(t.dataset.bmhEnhanced)return;const e=this.adapter.extractCardData(t);if(!e||!e.id&&!e.title)return;const o=this.findMatch(e);t.dataset.bmhEnhanced="true",t.addEventListener("mouseenter",()=>{const s=t.querySelector("bmh-quick-actions");s&&s.setAttribute("visible","")}),t.addEventListener("mouseleave",()=>{const s=t.querySelector("bmh-quick-actions");s&&s.removeAttribute("visible")}),this.settings.highlighting&&o&&this.applyBorder(t,o),this.settings.quickActions&&this.mountQuickActions(t,o||this.createTemporaryEntry(e))}findMatch(t){if(t.id){const e=`${this.adapter.id}:${t.id}`;if(this.library.has(e))return this.library.get(e)}if(t.slug){const e=`${this.adapter.id}:${t.slug}`;if(this.library.has(e))return this.library.get(e);if(this.library.has(t.slug))return this.library.get(t.slug)}return null}createTemporaryEntry(t){return{id:t.id,title:t.title,slug:t.slug,status:null,source:this.adapter.id,sourceUrl:t.url,lastReadChapter:null,personalData:{rating:0}}}applyBorder(t,e){const o=this.config?this.config.getStatusColor(e.status):"transparent";this.adapter.applyBorder?this.adapter.applyBorder(t,o):(t.style.border=`3px solid ${o}`,t.style.borderRadius="8px")}mountQuickActions(t,e){const o=document.createElement("bmh-quick-actions");o.entry=e,o.statusColors=this.config?this.config.statusColors:{},getComputedStyle(t).position==="static"&&(t.style.position="relative"),o.addEventListener("continue",()=>this.handleContinue(e)),o.addEventListener("open-status",s=>this.handleStatus(s,e)),o.addEventListener("open-rating",s=>this.handleRating(s,e)),o.addEventListener("details",()=>this.handleDetails(e)),t.appendChild(o)}handleContinue(t){t.lastReadUrl?window.location.href=t.lastReadUrl:t.sourceUrl&&(window.location.href=t.sourceUrl)}handleStatus(t,e){const o=t.target.getBoundingClientRect();this.mountPicker("bmh-status-picker",{currentStatus:e.status,statusColors:this.config.statusColors,position:{top:o.bottom+8,left:o.left}},s=>{this.updateLibraryEntry(e,{status:s})})}handleRating(t,e){var s;const o=t.target.getBoundingClientRect();this.mountPicker("bmh-rating-picker",{currentRating:((s=e.personalData)==null?void 0:s.rating)||0,position:{top:o.bottom+8,left:o.left}},r=>{const a=e.personalData||{};a.rating=r,this.updateLibraryEntry(e,{personalData:a})})}mountPicker(t,e,o){document.querySelectorAll("bmh-status-picker, bmh-rating-picker").forEach(r=>r.remove());const s=document.createElement(t);Object.assign(s,e),s.addEventListener("select",r=>{o(r.detail[0]),s.remove()}),s.addEventListener("close",()=>s.remove()),document.body.appendChild(s)}async updateLibraryEntry(t,e){var a;let s=(await chrome.storage.local.get(v.LIBRARY))[v.LIBRARY]||[];const r=s.findIndex(i=>i.source===t.source&&i.sourceId===t.id||i.slug&&i.slug===t.slug&&i.source===t.source);if(r!==-1)s[r]={...s[r],...e};else{if(!e.status&&!((a=e.personalData)!=null&&a.rating))return;const i=q({...t,...e});s.push(i)}await chrome.storage.local.set({[v.LIBRARY]:s}),console.log(`[CardEnhancer] Updated entry: ${t.title}`,e)}handleDetails(t){console.log("Details for",t),t.sourceUrl&&window.open(t.sourceUrl,"_blank")}}const at=":root{--color-primary: hsl(210, 100%, 55%);--color-primary-hover: hsl(210, 100%, 65%);--color-accent: hsl(270, 80%, 60%);--color-bg-base: hsl(220, 20%, 5%);--color-bg-surface: hsl(220, 15%, 8%);--color-bg-elevated: hsl(220, 15%, 12%);--color-text-primary: hsl(220, 15%, 90%);--color-text-secondary: hsl(220, 15%, 55%);--color-text-muted: hsl(220, 15%, 40%);--color-border: rgba(255, 255, 255, .1);--color-glass-bg: rgba(30, 35, 50, .75);--color-success: hsl(145, 65%, 45%);--color-warning: hsl(40, 100%, 50%);--color-error: hsl(0, 75%, 55%);--color-info: hsl(200, 90%, 50%)}:root{--font-sans: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;--font-mono: JetBrains Mono, Fira Code, Consolas, monospace;--text-xs: .75rem;--text-sm: .875rem;--text-base: 1rem;--text-lg: 1.125rem;--text-xl: 1.25rem;--text-2xl: 1.5rem;--text-3xl: 1.875rem;--text-4xl: 2.25rem}.autoscroll-panel{display:flex;align-items:center;gap:12px;padding:8px 12px;background:#0f0f14f2;border:1px solid rgba(255,255,255,.1);border-radius:12px;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);box-shadow:0 8px 32px #0009;color:#fff;font-family:Inter,system-ui,sans-serif;-webkit-user-select:none;user-select:none;transition:box-shadow .2s}.autoscroll-panel.is-dragging{box-shadow:0 12px 48px #000c,0 0 0 1px #fff3;cursor:grabbing}.toggle-btn{background:#4f46e5;color:#fff;border:none;padding:6px 12px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;min-width:80px;transition:all .2s ease}.toggle-btn:hover{background:#4338ca;transform:translateY(-1px)}.toggle-btn.active{background:#dc2626}.toggle-btn.active:hover{background:#b91c1c}.speed-control{display:flex;align-items:center;gap:8px}.label{font-size:11px;color:#ffffff80;text-transform:uppercase;font-weight:600}.speed-slider{width:80px;height:4px;-webkit-appearance:none;background:#fff3;border-radius:2px;outline:none;cursor:pointer}.speed-slider::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:#fff;border-radius:50%;transition:transform .1s}.speed-slider::-webkit-slider-thumb:hover{transform:scale(1.2)}.value{font-size:12px;font-variant-numeric:tabular-nums;width:24px;text-align:right;color:#ffffffe6}.drag-handle{color:#ffffff4d;font-size:18px;cursor:grab;padding:0 4px}.drag-handle:hover{color:#fff}",nt={class:"speed-control"},it=["value"],lt={class:"value"},ct={__name:"AutoScrollPanel.ce",props:{initialSpeed:{type:Number,default:50},initialState:{type:Boolean,default:!1}},emits:["update:speed","toggle"],setup(g,{expose:t,emit:e}){const o=g,s=e,r=E(o.initialSpeed),a=E(o.initialState),i=E(!1),p=()=>{a.value=!a.value,s("toggle",a.value)},x=d=>{const f=parseInt(d.target.value);r.value=f,s("update:speed",f)};let c,n,u,L;const M=d=>{i.value=!0;const f=d.target.getRootNode().host;c=d.clientX,n=d.clientY;const C=f.getBoundingClientRect();u=C.left,L=C.top,window.addEventListener("mousemove",_),window.addEventListener("mouseup",A)},_=d=>{if(!i.value)return;const f=d.clientX-c,C=d.clientY-n,k=d.target.getRootNode().host||d.target.closest("bmh-autoscroll-panel");k&&(k.style.left=`${u+f}px`,k.style.top=`${L+C}px`,k.style.bottom="auto",k.style.right="auto")},A=()=>{i.value=!1,window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",A)};return t({toggle:p,setSpeed:d=>{r.value=d,s("update:speed",d)}}),(d,f)=>(m(),b("div",{class:w(["autoscroll-panel",{"is-dragging":i.value}])},[l("button",{class:w(["toggle-btn",{active:a.value}]),onClick:p,title:"Space to toggle"},S(a.value?"⏸ Stop":"▶ Start"),3),l("div",nt,[f[0]||(f[0]=l("span",{class:"label"},"Speed",-1)),l("input",{type:"range",class:"speed-slider",min:"10",max:"300",value:r.value,onInput:x},null,40,it),l("span",lt,S(r.value),1)]),l("div",{class:"drag-handle",onMousedown:M},"⋮",32)],2))}},dt=$(ct,[["styles",[at]]]),pt=I(dt);customElements.get("bmh-autoscroll-panel")||customElements.define("bmh-autoscroll-panel",pt);class bt{constructor(t){this.adapter=t,this.autoScroll=null,this.config=null,this.settings={autoScrollEnabled:!1,autoScrollSpeed:50,keybindsEnabled:!0},this.scrollInterval=null,this.isScrolling=!1,this.panelElement=null}async init(){console.log("[ReaderEnhancer] Initializing..."),await this.loadSettings(),this.settings.autoScrollEnabled&&this.mountPanel(),this.settings.keybindsEnabled&&this.setupKeybinds(),this.startProgressTracking()}async loadSettings(){this.config=await z.load();const t=await chrome.storage.local.get(["autoScrollEnabled","autoScrollSpeed"]);this.settings.autoScrollEnabled=t.autoScrollEnabled!==!1,this.settings.autoScrollSpeed=t.autoScrollSpeed||50}mountPanel(){document.querySelector("bmh-autoscroll-panel")||(this.panelElement=document.createElement("bmh-autoscroll-panel"),this.panelElement.style.cssText=`
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
        `,this.panelElement.initialSpeed=this.settings.autoScrollSpeed,this.panelElement.initialState=!1,this.panelElement.addEventListener("toggle",t=>this.toggleScroll(t.detail[0])),this.panelElement.addEventListener("update:speed",t=>this.updateSpeed(t.detail[0])),document.body.appendChild(this.panelElement))}toggleScroll(t){t?this.startScroll():this.stopScroll()}startScroll(){if(this.scrollInterval)return;this.isScrolling=!0;const t=60,o=this.settings.autoScrollSpeed/t;let s=0;this.scrollInterval=setInterval(()=>{const r=this.findScrollTarget();s+=o;const a=Math.floor(s);a>=1&&(r===window?window.scrollBy(0,a):r.scrollTop+=a,s-=a)},1e3/t)}stopScroll(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null),this.isScrolling=!1,this.panelElement}updateSpeed(t){this.settings.autoScrollSpeed=t,chrome.storage.local.set({autoScrollSpeed:t}),this.isScrolling&&(this.stopScroll(),this.startScroll())}findScrollTarget(){const t=["#chapter-reader",".chapter-content",".reader-content",".reading-content","#content",".manga-reader",".read-container","main","article"];for(const e of t){const o=document.querySelector(e);if(o&&o.scrollHeight>o.clientHeight&&getComputedStyle(o).overflowY.includes("auto"))return o}return window}setupKeybinds(){document.addEventListener("keydown",t=>{var e,o,s,r;if(!["INPUT","TEXTAREA","SELECT"].includes(t.target.tagName)&&!(t.ctrlKey||t.altKey||t.metaKey))switch(t.key){case" ":t.preventDefault(),this.isScrolling?(this.toggleScroll(!1),this.panelElement&&this.panelElement.toggle()):(this.toggleScroll(!0),this.panelElement&&this.panelElement.toggle());break;case"ArrowDown":break;case"n":case"N":(o=(e=this.adapter).goToNextChapter)==null||o.call(e);break;case"p":case"P":(r=(s=this.adapter).goToPrevChapter)==null||r.call(s);break}})}startProgressTracking(){setTimeout(()=>{this.saveCurrentChapter()},5e3)}async saveCurrentChapter(){if(!this.adapter.parseUrl)return;const t=this.adapter.parseUrl(window.location.href);if(!t||!t.chapterNo)return;const{slug:e,id:o,chapterNo:s}=t;if(!(!e&&!o))try{const r=await chrome.storage.local.get(["savedReadChapters","savedEntriesMerged"]);let a=r.savedReadChapters||{},i=r.savedEntriesMerged||[];const p=e||`${this.adapter.id}:${o}`;a[p]||(a[p]=[]);const x=String(s);a[p].includes(x)||(a[p].push(x),a[p].sort((n,u)=>parseFloat(n)-parseFloat(u)),await chrome.storage.local.set({savedReadChapters:a}),console.log(`[ReaderEnhancer] Marked ch ${s} as read for ${p}`));const c=i.findIndex(n=>n.source===this.adapter.id&&n.sourceId===o||n.slug&&n.slug===e);if(c!==-1){const n=i[c],u=parseFloat(n.lastReadChapter||0);parseFloat(s)>u&&(n.lastReadChapter=s,n.lastReadUrl=window.location.href,n.lastReadDate=Date.now()),n.readChapters=a[p].length,i[c]=n,await chrome.storage.local.set({savedEntriesMerged:i})}}catch(r){console.error("[ReaderEnhancer] Failed to save progress",r)}}}export{ft as C,bt as R};
